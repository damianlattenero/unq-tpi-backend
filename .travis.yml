language: java
sudo: required
jdk:
 - oraclejdk8
before_install: sudo apt-get update; mysql -e "create database IF NOT EXISTS unqdb;" -uroot
dist: trusty
services:
  - mysql
addons:
  apt:
    packages:
    - mysql-server-5.6
    - mysql-client-core-5.6
    - mysql-client-5.6
before_script:
  - echo "USE mysql;\nUPDATE user SET password=PASSWORD('root') WHERE user='root';\nFLUSH PRIVILEGES;\n" | mysql -u travis
  - mysql -utravis -e 'CREATE DATABASE unqdb;'
  - mysql -utravis -e "CREATE USER 'admin'@'%' IDENTIFIED BY 'admin';"
  - mysql -utravis -e "GRANT ALL PRIVILEGES ON *.* TO 'admin'@'%' IDENTIFIED BY 'admin';"
script: 
  - echo "USE mysql;\nUPDATE user SET password=PASSWORD('root') WHERE user='root';\nFLUSH PRIVILEGES;\n" | mysql -u travis
  - mysql -utravis -e 'CREATE DATABASE unqdb;'
  - mysql -utravis -e "CREATE USER 'admin'@'%' IDENTIFIED BY 'admin';"
  - mysql -utravis -e "GRANT ALL PRIVILEGES ON *.* TO 'admin'@'%' IDENTIFIED BY 'admin';"
  - mvn test -Dmaven.compiler.target=1.8 -Dmaven.compiler.source=1.8
install: mvn install -Dmaven.compiler.target=1.8 -Dmaven.compiler.source=1.8
after_script:
  - cp target/site/jacoco/jacoco.xml .
  - git clone https://github.com/codacy/codacy-coverage-reporter.git
  - cd codacy-coverage-reporter/
  - sbt assembly
  - cd ..
  - java -cp codacy-coverage-reporter/target/codacy-coverage-reporter-assembly-1.0.5.jar com.codacy.CodacyCoverageReporter -l Java -r jacoco.xml
